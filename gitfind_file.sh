#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# 0.0.1
# Alexey Potehin <gnuplanet@gmail.com>, http://www.gnuplanet.ru/doc/cv
#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# check depends
function check_prog()
{
	for i in ${1};
	do
		if [ "$(which ${i})" == "" ];
		then
			echo "FATAL: you must install \"${i}\"...";
			return 1;
		fi
	done

	return 0;
}
#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# find file
function find_file()
{
	local HASH=$(git hash-object "${2}");


# save current dir
	DIR_CUR="${PWD}";
	cd -- "${1}";


	git rev-list --all |
	{
		while read -r COMMIT;
		do
			local TREE=$(git cat-file commit "${COMMIT}" | head -n 1 | grep '^tree' | { read a b; echo ${b}; });

			if [ "$(git ls-tree -r "${TREE}" | grep blob | grep "${HASH}" | wc -l)" != "0" ];
			then
				echo "ok, commit ${COMMIT}";
				cd -- "${DIR_CUR}";
				return 0;
			fi

		done
	}


	cd -- "${DIR_CUR}";
	return 1;
}
#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
# general function
function main()
{
	if [ ! -d "${1}" ] || [ ! -f "${2}" ];
	then
		echo "example: ${0} GITDIR FILE";
		return 1;
	fi


# check depends tools
	check_prog "echo git grep head wc";
	if [ "${?}" != "0" ];
	then
		return 1;
	fi


	find_file "${@}";


	return "${?}";
}
#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
main "${@}";

exit "${?}";
#-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------#
